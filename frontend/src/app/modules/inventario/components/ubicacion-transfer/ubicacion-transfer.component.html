<div class="transfer-container">
    <div class="header">
        <div class="breadcrumb">
            <span>Inventario</span>
            <span class="separator">></span>
            <span class="active">Transferir Insumos</span>
        </div>
        <h1>Transferir Insumos a Ubicación</h1>
    </div>

    <div class="transfer-card">
        <div class="selection-grid">
            <div class="form-group">
                <label>Origen (Orden de Compra Recibida)</label>
                <select [(ngModel)]="idOrdenSeleccionada" (change)="onOrdenChange()" name="origen">
                    <option [ngValue]="null">Seleccione una orden...</option>
                    <option *ngFor="let o of ordenesRecibidas" [ngValue]="o.idOrdenCompra">
                        OC #{{ o.nroOrden }} - {{ o.nombreProveedor }} ({{ o.fechaSolicitud }})
                    </option>
                </select>
            </div>

            <div class="form-group">
                <label>Destino (Ubicación de Almacén)</label>
                <select [(ngModel)]="idUbicacionDestino" name="destino">
                    <option [ngValue]="null">Seleccione una ubicación...</option>
                    <option *ngFor="let u of ubicaciones" [ngValue]="u.idUbicacion">
                        {{ u.codigo }} - {{ u.descripcion || 'Sin descripción' }}
                    </option>
                </select>
            </div>

            <div class="form-group">
                <label>Proyecto (Opcional)</label>
                <select [(ngModel)]="idProyectoSeleccionado" name="proyecto">
                    <option [ngValue]="null">Stock General (Sin Proyecto)</option>
                    <option *ngFor="let p of proyectos" [ngValue]="p.idProyecto">
                        {{ p.nombreProyecto }} ({{ p.codigoProyecto }})
                    </option>
                </select>
            </div>
        </div>

        <div class="items-checklist" *ngIf="idOrdenSeleccionada && insumosParaTransferir.length > 0">
            <div class="checklist-header">
                <h3>Insumos en la Orden</h3>
                <div class="select-all">
                    <input type="checkbox" [checked]="todosSeleccionados" (change)="toggleTodos()" id="selectAll">
                    <label for="selectAll" style="margin: 0; cursor: pointer;">Seleccionar Todos</label>
                </div>
            </div>

            <div class="items-list">
                <div class="item-row" *ngFor="let item of insumosParaTransferir">
                    <input type="checkbox" [(ngModel)]="item.seleccionado" (change)="actualizarTodosSeleccionados()"
                        [id]="'item-' + item.idInsumo">
                    <label [for]="'item-' + item.idInsumo" class="item-info">
                        <span class="item-name">{{ item.nombreInsumo }}</span>
                        <span class="item-stock">Cant: {{ item.stockActual }}</span>
                    </label>
                </div>
            </div>

            <div class="actions">
                <button class="btn-cancelar" (click)="limpiar()">Limpiar</button>
                <button class="btn-confirmar" (click)="confirmarTransferencia()" [disabled]="!idUbicacionDestino">
                    Confirmar transferencia
                </button>
            </div>
        </div>

        <div class="empty-state" *ngIf="idOrdenSeleccionada && insumosParaTransferir.length === 0">
            La orden seleccionada no tiene detalles cargados o ya han sido transferidos.
        </div>

        <div class="initial-state" *ngIf="!idOrdenSeleccionada">
            Seleccione una orden de compra recibida para comenzar la transferencia de insumos a una ubicación física.
        </div>
    </div>
</div>