<div class="modal-overlay" (click)="cerrarModal()">
  <div class="modal-detalle" (click)="$event.stopPropagation()">
    
    <!-- HEADER -->
    <div class="modal-header">
      <div class="header-info">
        <h2>{{ proyecto.nombreProyecto }}</h2>
        <div class="meta-info">
          <span class="codigo">{{ proyecto.codigoProyecto }}</span>
          <span class="separador">•</span>
          <span class="cliente">{{ proyecto.clienteNombre }}</span>
        </div>
      </div>
      <button class="btn-close" (click)="cerrarModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <!-- PROGRESO GENERAL -->
    <div class="progreso-general">
      <div class="progreso-header">
        <span>Progreso General</span>
        <span class="valor">{{ proyecto.progresoGeneral }}%</span>
      </div>
      <div class="barra-progreso">
        <div class="barra-fill" [style.width.%]="proyecto.progresoGeneral"></div>
      </div>
    </div>

    <!-- TABS -->
    <div class="tabs">
      <button 
        class="tab" 
        [class.active]="tabActiva === 'info'"
        (click)="tabActiva = 'info'">
        <i class="fas fa-info-circle"></i>
        Información
      </button>
      <button 
        class="tab" 
        [class.active]="tabActiva === 'areas'"
        (click)="tabActiva = 'areas'">
        <i class="fas fa-tasks"></i>
        Áreas y Avances
      </button>
      <button 
        class="tab" 
        [class.active]="tabActiva === 'materiales'"
        (click)="tabActiva = 'materiales'">
        <i class="fas fa-box"></i>
        Materiales
      </button>
      <button 
        class="tab" 
        [class.active]="tabActiva === 'observaciones'"
        (click)="tabActiva = 'observaciones'">
        <i class="fas fa-comment"></i>
        Observaciones
      </button>
    </div>

    <!-- CONTENIDO -->
    <div class="modal-content">
      
      <!-- TAB: INFORMACIÓN -->
      <div class="tab-content" *ngIf="tabActiva === 'info'">
        <div class="info-grid">
          <div class="info-item">
            <label>Tipo de Prenda</label>
            <span>{{ proyecto.tipoPrenda || 'No especificado' }}</span>
          </div>
          <div class="info-item">
            <label>Prioridad</label>
            <span class="badge" [ngClass]="'badge-' + proyecto.prioridad">
              {{ proyecto.prioridad }}
            </span>
          </div>
          <div class="info-item">
            <label>Estado</label>
            <span>{{ proyecto.estado }}</span>
          </div>
          <div class="info-item">
            <label>Cantidad Total</label>
            <span>{{ proyecto.cantidadTotal }} unidades</span>
          </div>
          <div class="info-item">
            <label>Cantidad Producida</label>
            <span>{{ proyecto.cantidadProducida || 0 }} unidades</span>
          </div>
          <div class="info-item">
            <label>Fecha Inicio</label>
            <span>{{ formatearFecha(proyecto.fechaInicio) }}</span>
          </div>
          <div class="info-item">
            <label>Fecha Fin</label>
            <span>{{ formatearFecha(proyecto.fechaFin) }}</span>
          </div>
          <div class="info-item">
            <label>Días Transcurridos</label>
            <span>{{ proyecto.diasTranscurridos }} días</span>
          </div>
          <div class="info-item full-width" *ngIf="proyecto.descripcion">
            <label>Descripción</label>
            <p>{{ proyecto.descripcion }}</p>
          </div>
        </div>
      </div>

      <!-- TAB: ÁREAS Y AVANCES -->
      <div class="tab-content" *ngIf="tabActiva === 'areas'">
        <div class="areas-layout">
          
          <!-- LISTA DE ÁREAS -->
          <div class="areas-lista">
            <div 
              class="area-item" 
              *ngFor="let area of AREAS"
              [class.seleccionada]="areaSeleccionada?.id === area.id"
              [class.completa]="estaCompleta(area)"
              [class.en-progreso]="enProgreso(area)"
              (click)="seleccionarArea(area)">
              
              <div class="area-icon" [style.background-color]="area.color">
                <i class="fas" [ngClass]="area.icono"></i>
              </div>
              
              <div class="area-info">
                <div class="area-nombre">{{ area.nombre }}</div>
                <div class="area-progreso">
                  <div class="mini-barra">
                    <div class="mini-fill" 
                         [style.width.%]="getAvanceArea(area)"
                         [style.background-color]="area.color">
                    </div>
                  </div>
                  <span class="porcentaje">{{ getAvanceArea(area) }}%</span>
                </div>
              </div>
              
              <div class="area-estado">
                <i class="fas" 
                   [ngClass]="getIconoEstadoArea(area)"
                   [style.color]="getColorEstadoArea(area)">
                </i>
              </div>
            </div>
          </div>

          <!-- PANEL DE ÁREA SELECCIONADA -->
          <div class="area-detalle" *ngIf="areaSeleccionada">
            <div class="area-header">
              <div class="area-title">
                <i class="fas" [ngClass]="areaSeleccionada.icono" [style.color]="areaSeleccionada.color"></i>
                <h3>{{ areaSeleccionada.nombre }}</h3>
              </div>
              <div class="area-status" 
                   [class.completa]="estaCompleta(areaSeleccionada)"
                   [class.en-progreso]="enProgreso(areaSeleccionada)">
                <i class="fas" [ngClass]="getIconoEstadoArea(areaSeleccionada)"></i>
                <span *ngIf="estaCompleta(areaSeleccionada)">Completada</span>
                <span *ngIf="enProgreso(areaSeleccionada)">En Progreso</span>
                <span *ngIf="pendiente(areaSeleccionada)">Pendiente</span>
              </div>
            </div>

            <p class="area-descripcion">{{ areaSeleccionada.descripcion }}</p>

            <!-- FORMULARIO DEL ÁREA -->
            <div class="form-area">
              
              <!-- Aquí irán los campos específicos de cada área en el futuro -->
              <div class="form-placeholder">
                <i class="fas fa-clipboard-list"></i>
                <p>Formulario específico del área</p>
                <small>Los campos personalizados se agregarán aquí</small>
              </div>

              <!-- OBSERVACIONES DEL ÁREA -->
              <div class="form-group">
                <label>
                  <i class="fas fa-comment"></i>
                  Observaciones (opcional)
                </label>
                <textarea 
                  [(ngModel)]="observacionArea" 
                  rows="4"
                  placeholder="Agrega detalles o notas sobre el trabajo realizado en esta área..."
                  [disabled]="estaCompleta(areaSeleccionada)">
                </textarea>
              </div>

              <!-- BOTÓN DE CONTINUAR / FINALIZAR -->
              <button 
                *ngIf="!estaCompleta(areaSeleccionada)"
                class="btn-continuar" 
                [class.btn-finalizar]="esUltimaArea"
                (click)="continuarSiguienteArea()"
                [disabled]="procesandoArea">
                <i class="fas" [ngClass]="procesandoArea ? 'fa-spinner fa-spin' : (esUltimaArea ? 'fa-flag-checkered' : 'fa-arrow-right')"></i>
                <span *ngIf="!procesandoArea">
                  {{ esUltimaArea ? 'Finalizar Proyecto' : 'Continuar a ' + siguienteArea?.nombreCorto }}
                </span>
                <span *ngIf="procesandoArea">Procesando...</span>
              </button>

              <div class="area-completada-msg" *ngIf="estaCompleta(areaSeleccionada)">
                <i class="fas fa-check-circle"></i>
                <span>Esta área ya ha sido completada</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- TAB: MATERIALES -->
      <div class="tab-content" *ngIf="tabActiva === 'materiales'">
        <div class="materiales-lista">
          <div class="material-item" *ngFor="let material of proyecto.materiales">
            <div class="material-info">
              <span class="material-nombre">{{ material.nombreInsumo }}</span>
              <span class="material-cantidad">
                {{ material.cantidadAsignada }} {{ material.unidadMedida }}
              </span>
            </div>
            <div class="material-detalle" *ngIf="material.cantidadUtilizada">
              <small>Utilizado: {{ material.cantidadUtilizada }}</small>
            </div>
          </div>
          <div class="empty-state" *ngIf="!proyecto.materiales || proyecto.materiales.length === 0">
            <i class="fas fa-box-open"></i>
            <p>No hay materiales asignados</p>
          </div>
        </div>
      </div>

      <!-- TAB: OBSERVACIONES -->
      <div class="tab-content" *ngIf="tabActiva === 'observaciones'">
        <div class="observaciones-form">
          <textarea 
            [(ngModel)]="nuevaObservacion" 
            rows="3"
            placeholder="Escribe una observación general sobre el proyecto...">
          </textarea>
          <button 
            class="btn-agregar-obs" 
            (click)="agregarObservacion()"
            [disabled]="!nuevaObservacion.trim() || guardandoObservacion">
            <i class="fas" [ngClass]="guardandoObservacion ? 'fa-spinner fa-spin' : 'fa-plus'"></i>
            {{ guardandoObservacion ? 'Guardando...' : 'Agregar Observación' }}
          </button>
        </div>

        <div class="observaciones-lista">
          <div class="observacion-item" *ngFor="let obs of proyecto.observaciones">
            <div class="obs-header">
              <span class="obs-usuario">
                <i class="fas fa-user-circle"></i>
                {{ obs.nombreUsuario }}
              </span>
              <span class="obs-fecha">{{ formatearFecha(obs.fecha) }}</span>
            </div>
            <p class="obs-texto">{{ obs.descripcion }}</p>
          </div>
          <div class="empty-state" *ngIf="!proyecto.observaciones || proyecto.observaciones.length === 0">
            <i class="fas fa-comment-slash"></i>
            <p>No hay observaciones</p>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>